<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<!-- Bootstrap CSS -->
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
			integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
			crossorigin="anonymous"
		/>

		<!-- Add icon library -->
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
		/>

		<link rel="stylesheet" href="CSS/style.css" />
		<script src="JS/jscript.js"></script>
		<title>Admin Page Artifacts</title>
		<link rel="icon" type="image/x-icon" href="Images/museum.png" />

		<!-- Optional JavaScript -->
		<!-- jQuery first, then Popper.js, then Bootstrap JS -->
		<script
			src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
			integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
			crossorigin="anonymous"
		></script>
		<script
			src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
			integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
			crossorigin="anonymous"
		></script>
		<script
			src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
			integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
			crossorigin="anonymous"
		></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
		<style>
			.search-style {
				background-color: #ffdaad;
				background: rgba(255, 255, 255, 0.7);
				border-radius: 5px;
				border: 1px solid #000000;
			}
		</style>
		<script>
			document.addEventListener("DOMContentLoaded", function () {
				getLoggedIn();
			});
			var getLoggedIn = function () {
				var loggedIn = $.ajax({
					url: "http://localhost:3000/checkAdmin",
					type: "POST",
					crossDomain: true,
					xhrFields: {
						withCredentials: true,
					},
					success: function (result) {
						console.log(result);
						if (result == "Logged in") {
							var divOverall = document.createElement("div");
							var divOverlay = document.createElement("div");
							divOverlay.classList.add("overlay");
							var h1 = document.createElement("h1");
							h1.classList.add("maintitle");
							h1.innerHTML = "Admin Page";

							divOverlay.appendChild(h1);
							var buttonContainer = document.createElement("div");
							buttonContainer.classList.add("container");
							var backButton = document.createElement("button");
							backButton.classList.add("btn", "btn-primary");
							backButton.setAttribute("type", "button");
							backButton.setAttribute(
								"onclick",
								"location.href='../Project/admin.html'"
							);
							backButton.innerHTML = "Back to Admin Page";
							buttonContainer.appendChild(backButton);
							var divContainer = document.createElement("div");
							divContainer.classList.add("container");
							var formHeader = document.createElement("h4");
							formHeader.innerHTML = "Add artifact";
							var form = document.createElement("form");
							form.setAttribute("id", "addArtifact");

							var divQ1 = document.createElement("div");
							divQ1.classList.add("mb-3");
							var label1 = document.createElement("label");
							label1.classList.add("form-label", "labelQ");
							label1.setAttribute("for", "textarea1");
							label1.innerHTML = "Name:";
							var textArea1 = document.createElement("textarea");
							textArea1.classList.add("form-control");
							textArea1.setAttribute("id", "textarea1");
							textArea1.setAttribute("name", "name");
							textArea1.setAttribute("rows", "1");
							divQ1.appendChild(label1);
							divQ1.appendChild(textArea1);

							var divQ2 = document.createElement("div");
							divQ2.classList.add("mb-3");
							var label2 = document.createElement("label");
							label2.classList.add("form-label", "labelQ");
							label2.setAttribute("for", "date");
							label2.innerHTML = "Date:";
							var dateInput = document.createElement("input");
							dateInput.classList.add("form-control");
							dateInput.setAttribute("id", "date");
							dateInput.setAttribute("name", "date");
							dateInput.setAttribute("type", "date");
							divQ2.appendChild(label2);
							divQ2.appendChild(dateInput);

							var divQ3 = document.createElement("div");
							divQ3.classList.add("mb-3");
							var label3 = document.createElement("label");
							label3.classList.add("form-label", "labelQ");
							label3.setAttribute("for", "textarea2");
							label3.innerHTML = "Description:";
							var textarea2 = document.createElement("textarea");
							textarea2.classList.add("form-control");
							textarea2.setAttribute("id", "textarea2");
							textarea2.setAttribute("name", "description");
							textarea2.setAttribute("rows", "3");
							divQ3.appendChild(label3);
							divQ3.appendChild(textarea2);

							var divQ4 = document.createElement("div");
							divQ4.classList.add("mb-3");
							var label4 = document.createElement("label");
							label4.classList.add("form-label", "labelQ");
							label4.setAttribute("for", "textarea3");
							label4.innerHTML = "Image Source:";
							var textarea3 = document.createElement("textarea");
							textarea3.classList.add("form-control");
							textarea3.setAttribute("id", "textarea3");
							textarea3.setAttribute("name", "image");
							textarea3.setAttribute("rows", "1");
							divQ4.appendChild(label4);
							divQ4.appendChild(textarea3);

							var divQ5 = document.createElement("div");
							divQ5.classList.add("mb-3");
							var label5 = document.createElement("label");
							label5.classList.add("form-label", "labelQ");
							label5.setAttribute("for", "textarea4");
							label5.innerHTML = "Tags:";
							var textarea4 = document.createElement("textarea");
							textarea4.classList.add("form-control");
							textarea4.setAttribute("id", "textarea4");
							textarea4.setAttribute("name", "tags");
							textarea4.setAttribute("rows", "1");
							divQ5.appendChild(label5);
							divQ5.appendChild(textarea4);

							divSubmit = document.createElement("div");
							h4Message = document.createElement("h4");
							h4Message.setAttribute("id", "submit-message");
							submitButton = document.createElement("button");
							submitButton.classList.add("btn", "btn-primary");
							submitButton.setAttribute("type", "button");
							submitButton.setAttribute("onclick", "addArtifact(this.form)");
							submitButton.innerHTML = "Submit";
							divSubmit.appendChild(h4Message);
							divSubmit.appendChild(submitButton);

							divContainer.appendChild(formHeader);
							divContainer.appendChild(form);
							form.appendChild(divQ1);
							form.appendChild(divQ2);
							form.appendChild(divQ3);
							form.appendChild(divQ4);
							form.appendChild(divQ5);
							form.appendChild(divSubmit);

							divOverall.appendChild(divOverlay);
							divOverall.appendChild(buttonContainer);
							divOverall.appendChild(divContainer);
							document.getElementById("admin").appendChild(divOverall);

							divSearch = document.createElement("div");
							divSearch.classList.add("row", "justify-content-center");
							divSearch2 = document.createElement("div");
							divSearch2.classList.add(
								"input-group",
								"col-sm-2",
								"col-md-4",
								"mb-3"
							);
							search = document.createElement("input");
							search.classList.add("form-control");
							search.setAttribute("type", "text");
							search.setAttribute("id", "nameInput");
							search.setAttribute("placeholder", "Search..");
							search.setAttribute("aria-label", "Search..");
							search.setAttribute("aria-describedby", "basic-addon2");
							divSearch2.appendChild(search);
							divSearch.appendChild(divSearch2);

							divSearchBtn = document.createElement("div");
							divSearchBtn.classList.add("input-group-append");
							SearchBtn = document.createElement("button");
							SearchBtn.classList.add("btn", "btn-secondary");
							SearchBtn.setAttribute("type", "button");
							searchIcon = document.createElement("i");
							searchIcon.classList.add("fa", "fa-search");
							searchIcon.setAttribute("arial-hidden", "true");
							SearchBtn.appendChild(searchIcon);
							divSearchBtn.appendChild(SearchBtn);
							divSearch.appendChild(divSearchBtn);
							document.getElementById("admin").appendChild(divSearch);

							divHeaders = document.createElement("div");
							divHeaders.classList.add("row", "justify-content-center");
							divCol = document.createElement("div");
							divCol.classList.add("col-9");
							divRow = document.createElement("div");
							divRow.classList.add("row");
							divImage = document.createElement("div");
							divImage.classList.add("col-2", "search-style");
							aImage = document.createElement("a");
							aImage.innerHTML = "Image";
							divImage.appendChild(aImage);
							divName = document.createElement("div");
							divName.classList.add("col-4", "search-style");
							aName = document.createElement("a");
							aName.innerHTML = "Name";
							divName.appendChild(aName);
							divDesc = document.createElement("div");
							divDesc.classList.add("col-6", "search-style");
							aDesc = document.createElement("a");
							aDesc.innerHTML = "Description";
							divDesc.appendChild(aDesc);
							divRow.appendChild(divImage);
							divRow.appendChild(divName);
							divRow.appendChild(divDesc);
							divCol.appendChild(divRow);
							divHeaders.appendChild(divCol);
							document.getElementById("admin").appendChild(divHeaders);

							divResult = document.createElement("div");
							divResult.classList.add("row", "justify-content-center");
							divR = document.createElement("div");
							divR.classList.add("col-9");
							divR.setAttribute("id", "queryContainer");
							divR.setAttribute(
								"style",
								"height: 58vh; overflow: scroll; overflow-x: hidden"
							);
							divResult.appendChild(divR);
							document.getElementById("admin").appendChild(divResult);
							document
								.getElementById("nameInput")
								.addEventListener("keyup", function () {
									onTypeArtifactQuery();
								});
						}
					},
					error: function (xhr, status, error) {
						divContainer = document.createElement("div");
						divContainer.classList.add("container");
						errorMessage = document.createElement("h1");
						errorMessage.classList.add("text-center");
						errorMessage.setAttribute("id", "error-message");
						errorMessage.innerHTML = xhr.status + ": " + error;
						divContainer.appendChild(errorMessage);
						document.getElementById("admin").appendChild(divContainer);
					},
				});
			};

			function addArtifact(form) {
				var hi = {
					name: form.name.value,
					date: form.date.value,
					description: form.description.value,
					image: form.image.value,
					tag: form.tags.value,
				};
				if (
					hi.name != "" &&
					hi.date != "" &&
					hi.description != "" &&
					hi.image != "" &&
					hi.tag != ""
				) {
					var he = $.ajax({
						url: "http://localhost:3000/addArtifact",
						type: "POST",
						contentType: "application/x-www-form-urlencoded; charset=utf-8",
						data: hi,
						success: function (result) {},
					});
				} else {
					document.getElementById("submit-message").innerHTML =
						"Fill the form out fully";
				}
			}

			var onTypeArtifactQuery = function () {
				//get data from database using $.ajax post request from jquery
				var data = $.ajax({
					url:
						"http://localhost:3000/queryArtifacts?name=" +
						document.getElementById("nameInput").value,
					type: "POST",
					contentType: "application/json; charset=utf-8",
					success: function (data) {
						//on success render the returned data
						console.log(data);

						var container = document.getElementById("queryContainer");

						//clear all previous results
						container.innerHTML = "";

						for (var i = 0; i < data.length; i++) {
							renderQueryResult(
								data[i].artifact_id,
								data[i].image_source,
								data[i].name,
								data[i].description,
								container
							);
						}
					},
					error: function (xhr, status, error) {
						//on failure to fetch the request write to console
						console.error(status + ": " + xhr.responseText);
					},
				});
			};
			function deleteArtifact(id) {
				console.log(id);
				var data = {
					artifactID: id,
				};
				var loggedIn = $.ajax({
					url: "http://localhost:3000/deleteArtifact",
					type: "POST",
					crossDomain: true,
					data: data,
					contentType: "application/x-www-form-urlencoded; charset=utf-8",
					success: function (result) {
						console.log(result);
						document.getElementById("message").innerHTML = "Event deleted";
					},
				});
			}
			function renderQueryResult(id, imagePath, name, description, parent) {
				var holder = document.createElement("div");
				holder.classList.add("row");

				holder.setAttribute(
					"style",
					"margin: 3px; border: 2px solid black; background-color: #ffdaad; background: rgba(255,255,255,0.7); border-radius: 5px;"
				);

				var holderImage = document.createElement("div");
				holderImage.classList.add("col-2");
				var image = document.createElement("img");
				image.setAttribute("src", imagePath);
				image.setAttribute("height", "100%");
				image.setAttribute("width", "100%");
				holderImage.appendChild(image);

				var holderName = document.createElement("div");
				holderName.classList.add("col-3");
				var nameP = document.createElement("a");
				nameP.innerHTML = name;
				nameP.href = "artifact.html?id=" + id;
				nameP.classList.add("remove-link-styling");
				var message = document.createElement("h5");
				message.setAttribute("id", "message");
				holderName.appendChild(nameP);
				holderName.appendChild(message);

				var holderDescription = document.createElement("div");
				holderDescription.classList.add("col-5");
				holderDescription.setAttribute(
					"style",
					"height: 10vh; overflow-x: hidden; overflow-y: hidden;"
				);
				var descriptionP = document.createElement("a");
				descriptionP.innerHTML = description;
				descriptionP.href = "artifact.html?id=" + id;
				descriptionP.classList.add("remove-link-styling");
				holderDescription.appendChild(descriptionP);

				var holderButtons = document.createElement("div");
				holderButtons.classList.add("col-2");
				holderButtons.setAttribute(
					"style",
					"height: 10vh; overflow-x: hidden; overflow-y: hidden;"
				);
				var editButton = document.createElement("button");
				editButton.classList.add("btn", "btn-primary");
				editButton.innerHTML = "Edit Artifact";
				editButton.setAttribute("type", "button");
				editButton.setAttribute("onclick", 'editArtifact("' + id + '")');

				var deleteButton = document.createElement("button");
				deleteButton.classList.add("btn", "btn-primary");
				deleteButton.innerHTML = "Delete Artifact";
				deleteButton.setAttribute("type", "button");
				deleteButton.setAttribute("id", "deleteButton");
				deleteButton.setAttribute("onclick", 'deleteArtifact("' + id + '")');

				holderButtons.appendChild(editButton);
				holderButtons.appendChild(deleteButton);

				holder.appendChild(holderImage);
				holder.appendChild(holderName);
				holder.appendChild(holderDescription);
				holder.appendChild(holderButtons);
				parent.appendChild(holder);
			}
			function editArtifact(id) {
				location.href = "../Project/admineditArtifacts.html?id=" + id;
			}
		</script>
	</head>
	<body>
		<div id="admin"></div>
		<!-- <div class="row justify-content-center">
			<div class="input-group col-sm-2 col-md-4 mb-3">
				<input
					type="text"
					class="form-control"
					id="nameInput"
					placeholder="Search.."
					aria-label="Search.."
					aria-describedby="basic-addon2"
				/>
				<div class="input-group-append">
					<button class="btn btn-secondary" type="button">
						<i class="fa fa-search" arial-hidden="true"></i>
					</button>
				</div>
			</div>
		</div>

		<div class="row justify-content-center">
			<div class="col-9">
				<div class="row">
					<div class="col-2 search-style">
						<a>Image</a>
					</div>
					<div class="col-4 search-style">
						<a>Name</a>
					</div>
					<div class="col-6 search-style">
						<a>Description</a>
					</div>
				</div>
			</div>
		</div>
		<div class="row justify-content-center">
			<div
				id="queryContainer"
				style="height: 58vh; overflow: scroll; overflow-x: hidden"
				class="col-9"
			></div>
		</div> -->
	</body>
</html>
